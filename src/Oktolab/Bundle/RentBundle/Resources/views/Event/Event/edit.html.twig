{% extends 'OktolabRentBundle::layoutFocusedTask.html.twig' %}

{% block content_header %}
    <div class="aui-page-header-inner">
        <div class="aui-page-header-main">
            <h1>{{ 'Rental Track'|trans }}</h1>
        </div>
        <div class="aui-page-header-actions">
            <ol class="aui-progress-tracker aui-progress-tracker-inverted">
                {% set state = form.vars.value.state %}
                {% set current = 'aui-progress-tracker-step-current' %}

                <li class="aui-progress-tracker-step"><span>{{ 'Erstellen'|trans }}</span></li>
                <li class="aui-progress-tracker-step {{ state is constant('\\Oktolab\\Bundle\\RentBundle\\Entity\\Event::STATE_PREPARED') ? current : '' }}"><span>{{ 'Bearbeiten'|trans }}</span></li>
                <li class="aui-progress-tracker-step {{ state is constant('\\Oktolab\\Bundle\\RentBundle\\Entity\\Event::STATE_LENT') ? current : '' }}"><span>{{ 'Ausgeben'|trans }}</span></li>
                <li class="aui-progress-tracker-step {{ state is constant('\\Oktolab\\Bundle\\RentBundle\\Entity\\Event::STATE_DELIVERED') ? current : '' }}"><span>{{ 'Abgeschlossen'|trans }}</span></li>
            </ol>
        </div>
    </div>
{% endblock %}

{% block content %}
    <div id="event-form">
        <h2>{{ 'generic.edit' | trans }} - {{ form.vars.value.name }}</h2>
        {{ form_start(form, {'attr': {'class': 'aui'} }) }}
            <fieldset>
                {{ form_errors(form) }}

                {{ form_row(form.name) }}
                {{ form_row(form.costunit, { 'attr': { 'data-name': form.vars.value.costunit is not null ? form.vars.value.costunit.name : '' } }) }}
                {{ form_row(form.contact, { 'attr': { 'data-name': form.vars.value.contact is not null ? form.vars.value.contact.name : '' } } ) }}
                {{ form_row(form.description) }}
                {{ form_row(form.begin, {'attr': {'data-timeblockStarts': timeblock_starts}}) }}
                {{ form_row(form.end,  {'attr': {'data-timeblockEnds': timeblock_ends}}) }}
            </fieldset>

            <h3>{{ 'event.rentable_objects'|trans }}</h3>
            <fieldset>
                <div class="field-group">
                    <label for="oktolabrentbundle_event_editform_searchfield">{{ 'generic.search'|trans }}</label>
                    <input class="text long-field" type="text" id="oktolabrentbundle_event_editform_searchfield" name="oktolab_rentbundle_editform_searchfield" title="{{ 'Search for Barcodes, Items, Sets, ...'|trans }}">
                    <span class="aui-icon aui-icon-small aui-iconfont-search">{{ 'generic.search'|trans }}</span>
                    <div class="description">{{ 'event.searchFor'|trans }} {{'generic.barcodes'|trans}}, {{'inventory.items'|trans}}, {{'inventory.sets'|trans}}, ...</div>
                </div>

                <div class="field-group aui-oktolab-form-table">
                    <label>{{ 'event.objects'|trans }}</label>
                    <table class="aui">
                        <thead>
                            <tr>
                                <th id="basic-barcode">{{ 'Barcode'|trans }}</th>
                                <th id="basic-name">{{ 'Name'|trans }}</th>
                                <th id="basic-action"><span class="aui-icon aui-icon-small aui-iconfont-configure">{{ 'Actions'|trans }}</span></th>
                            </tr>
                        </thead>
                        <tbody class="event-objects"
                               data-prototype="{% filter escape %}{% include 'OktolabRentBundle:Event:eventObjectPrototype.html.twig' %}{% endfilter %}"
                               data-index="{{ objects|length }}">
                            {% for object in objects if objects %}
                                {% set formobject = form.objects[loop.index0] %}
                                {% set objective = '%s:%s'|format(object.type, object.id) %}

                                <tr data-value="{{ objective }}">
                                    <td>{{ object.barcode }}</td>
                                    <td>{{ object.title }}</td>
                                    <td class="event-object-icons">
                                        <a href="#" class="remove" data-value="{{ objective }} ">
                                            <span class="aui-icon aui-icon-small aui-iconfont-remove">{{ 'Remove'|trans }}</span>
                                        </a>
                                        <a href="#" class="scan" data-value="{{ objective }}">
                                            <span class="aui-icon aui-icon-small aui-iconfont-approve">{{ 'Scan'|trans }}</span>
                                        </a>
                                    </td>
                                    <td class="hidden">{{ form_row(formobject, { 'attr': { 'data-value': objective } }) }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </fieldset>

            <div class="buttons-container">
                <div class="buttons">
                    {% if form.vars.value.state == 2 %}
                        {{ form_widget(form.rent, {'attr': { 'class': 'aui-button aui-button-primary', 'aria-disabled': 'true' }, 'label': 'Deliver' }) }}
                    {% else %}
                        {{ form_widget(form.rent, {'attr': { 'class': 'aui-button aui-button-primary', 'aria-disabled': 'true' } }) }}
                        {{ form_widget(form.update, {'attr': { 'class': 'aui-button' } }) }}
                    {% endif %}

                    {% if form.vars.value.id is not null %}
                        <a href="{{ path('event_pdf', { 'id': form.vars.value.id }) }}" class="aui-button">{{ 'Print Sheet'|trans }}</a>
                    {% endif %}

                    {# form_widget(form.delete, {'attr': { 'class': 'aui-button' } }) #}
                    {{ form_widget(form.cancel, {'attr': { 'class': 'aui-button aui-button-link' } }) }}
                </div>
            </div>

            {% do form.objects.setRendered %}
            {% do form.update.setRendered %}
            {% do form.delete.setRendered %}
        {{ form_end(form) }}
    </div>
{% endblock %}
